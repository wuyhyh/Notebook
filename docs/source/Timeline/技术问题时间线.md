# 技术问题时间线

记录解决的技术问题列表，和相关思路

## 20250827

1. PBF DDR training失败

解决办法是在 PBF 配置阶段关闭 one channel drive two slot

2. uboot shell 和 ramdisk Linux 找不到 nvme SSD

解决办法是在 PBF 配置阶段配置 PCIe 为 x8x8，RC mode

3. uboot 使用串口工具进行更新

下载 terarterm

## 20250918

1. uboot 启动日志优化，缩短启动时间
2. 达成使用openEuler 5.10内核启动系统，但是沿用的是旧版 Linux 设备树和旧版根文件系统
3. 修改 ethact 环境变量，实现了uboot下两路网络通信

## 20250922

1. 下载根文件系统到 SSD
2. 解决操作系统内核对INFINIBAND的支持
3. 需要编译一个可用的ramdisk，现在的ramdisk启动概率性成功
4. 根文件系统已经启动，网络出现问题，PHY芯片驱动需要修改
5. 内核抢占模式需要修改
6. 内核ARMv8硬件加速需要关闭

```text
tftpboot 0x90400000 Image--5.10-r0-phytium-20250922043226.bin;tftpboot 0x90000000 output.dtb
```

```text
tftpboot 0x90400000 Image--5.10-r0-phytium-20250922093636.bin;tftpboot 0x90000000 output.dtb
```

```text
setenv bootargs "console=ttyAMA1,115200 audit=0 earlycon=pl011,0x28004000 noinitrd root=/dev/nvme0n1p1 rootwait rw arm64.nolse=1 maxcpus=1 modprobe.blacklist=aes_ce_blk,aes_ce_cipher,sha2_ce,sha256_ce,crc32_arm64,crc32c_arm64,crc32"
```

```text
booti 0x90400000 - 0x90000000
```

```text
tftp -g -r tmp.tar.gz 192.168.11.100
```

```text
setenv bootargs "console=ttyAMA1,115200 audit=0 earlycon=pl011,0x28004000 noinitrd root=/dev/nvme0n1p1 rootwait rw maxcpus=1"
```

## 20250923

1. 修改 uboot 网络驱动，支持 8211 芯片自动配置

```text
tftpboot 0x90400000 Image--5.10-r0-phytium-20250922043226.bin;tftpboot 0x90000000 u-boot-d2000-devboard-dsk.dtb
```

```text
setenv bootargs "console=ttyAMA1,115200 audit=0 earlycon=pl011,0x28004000 noinitrd root=/dev/nvme0n1p1 rootwait rw arm64.nolse=1 maxcpus=1 modprobe.blacklist=aes_ce_blk,aes_ce_cipher,sha2_ce,sha256_ce,crc32_arm64,crc32c_arm64,crc32"
```

```text
booti 0x90400000 - 0x90000000
```

## 20250924

1. PHY 芯片配置互相影响

```text
setenv ipaddr 192.168.11.102
setenv serverip 192.168.11.100
saveenv
```

```text
setenv enableNet "mii write 0x7 0x1e 0xa003; mii write 0x7 0x1f 0x8007;mii write 0x7 0x1e 0xa004; mii write 0x7 0x1f 0x00b0;mii write 0x7 0x1e 0xa001; mii write 0x7 0x1f 0x0164;mii read  0x7 0x11;"
saveenv
```

## 20250926

1. 网络问题
2. CPU0卡死
3. 新设备树编译问题

```text
./my_scripts/fix_parameter.sh
```

```text
make ARCH=arm CROSS_COMPILE=aarch64-linux-gnu- hpc_board_defconfig
```

## 20250928

1. 打包脚本有问题，导致SPL阶段启动失败，更换新的打包脚本包已解决问题
2. 新设备树版本的uboot网络设备无法识别
3. 串口正常，还不知道flash驱动是否正常，这涉及到qspi总线问题

## 20250929

1. 焊接了接地线，确保 flash disable，能从 emulator 启动
2. 更换设备树之后，系统无法启动

## 20250930

1. 继续适配设备树，找出不能启动的原因
2. 编译 fiptool 工具

```text
sudo apt-get install -y build-essential libssl-dev   # 若未安装依赖

git clone https://git.trustedfirmware.org/TF-A/trusted-firmware-a.git

cd trusted-firmware-a/tools/fiptool

gcc -D_GNU_SOURCE -D_XOPEN_SOURCE=700 -O2 -Wall -Werror -pedantic -std=c99 \
    -I../../include/tools_share \
    fiptool.c tbbr_config.c \
    -lcrypto -o fiptool

./fiptool --help
```

```text
ls -l u-boot.dtb
```

设备树从1347B变为了9879B

## 20251009

现象：

1. uboot在BL2阶段启动卡住
2. 设备树从1KB增大到9KB

猜想：

1. 设备树编译后体积增大，会不会真的引起fip.bin的布局错误？导致无法启动？

思路：

1. 修改打包脚本，fip.bin的布局中不需要的部分覆盖了没事，但是系统找不到需要启动的部分

## 20251010

1. uboot 的网络问题完全解决

## 20251011

1. flash 芯片温度敏感

温度高的时候flash写入或者读取数据可能有问题，这个最好看看手册里面有没有描述。
我观察到的现象是，确定软件没有问题，如果不加风扇，温度高的情况下写入uboot到flash，写入成功后，重启大概率异常。
如果我一直开风扇，在低温的状态下写入flash，然后重启一切正常。

很可能就是flash芯片温度导致之前我们误判flash坏了，再高温的时候，使用烧录器作为emulator启动uboot，完全可以正常启动。
flash芯片对温度可能比较敏感

结论：

如果一直打开散热风扇，系统工作正常

2. 完善 U-Boot 部分的文档

# 核心板操作系统部署

## 0. 硬件和环境

nvme ssd 的总容量119.2G，分为3个分区。

```text
[root@fedora ~]# lsblk
NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
nvme0n1     259:0    0 119.2G  0 disk
|-nvme0n1p1 259:1    0    20G  0 part
|-nvme0n1p2 259:2    0    50G  0 part /
`-nvme0n1p3 259:3    0    48G  0 part
```

在 p1 安装 openeuler embedded
在 p1 安装 fedora rootfs + phytium embedded 内核
在 p1 安装 openeuler rootfs + openeuler server + phytium BSP 内核

网络在 end0 连接外网，静态IP 配置为 192.168.115。end1配置内网直连PC 192.168.11.105，通过SSH登录。



---

## 1. 网络配置：静态 IP + NetworkManager

```text
[root@fedora ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: end0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 3c:6a:2c:3c:6a:2c brd ff:ff:ff:ff:ff:ff
    altname enx3c6a2c3c6a2c
    inet 192.168.1.113/24 brd 192.168.1.255 scope global dynamic noprefixroute end0
       valid_lft 6723sec preferred_lft 6723sec
3: end1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 3c:6a:2c:3c:6a:2d brd ff:ff:ff:ff:ff:ff
    altname enx3c6a2c3c6a2d
```

## 2. U-Boot 命令行启动参数

### 2.1 启动 openeuler embedded

```text
bootargs=console=ttyAMA1,115200 root=/dev/nvme0n1p1 rw rootwait earlycon ignore_loglevel loglevel=8 audit=0
bootcmd_nvme=pci init; nvme scan; \
ext4load nvme 0:1 ${kernel_addr_r} /boot/Image; \
ext4load nvme 0:1 ${fdt_addr_r}    /boot/dtbs/pd2008-devboard-dsk.dtb; \
booti ${kernel_addr_r} - ${fdt_addr_r}

run bootcmd_nvme
```

### 2.2 启动 fedora

```text
# 1) 正常设置 bootargs（你已经有了）

setenv bootargs 'console=ttyAMA1,115200 console=ttyAMA0,115200 earlycon=pl011,0x28001000 loglevel=8 ignore_loglevel
root=/dev/nvme0n1p2 rootfstype=ext4 rw rootwait nr_cpus=8 nmi_watchdog=0 panic=-1 init=/lib/systemd/systemd'

# 2) load kernel + dtb

ext4load nvme 0:2 ${kernel_addr_r} /boot/Image
ext4load nvme 0:2 ${kernel_addr_r} /boot/Image-5.10.0-baseline_2026Q1-2
ext4load nvme 0:2 ${fdt_addr_r} /boot/dtb/pd2008-devboard-dsk.dtb

# 3) 把 bootargs 写入 dtb 的 /chosen/bootargs

fdt addr ${fdt_addr_r}
fdt resize 1024
fdt set /chosen bootargs "${bootargs}"

# 4) 再 bootefi

bootefi ${kernel_addr_r} ${fdt_addr_r}
```

## 3. 进入 fedora 编译内核并安装到fedora

phytium-embedded 版本内核源码包 phytium-linux-kernel-linux-5.10.zip

安装编译工具，并关闭 `fatal error: openssl/engine.h: No such file or directory`

## 4. 在 fedora 中制作 p3 分区的 openeuler server 版本 rootfs

安装必要工具，并制作 openEuler-22.03-LTS-SP4-everything-aarch64-dvd.iso 对应的用户态

内核装入 phytium-embedded 版本内核

然后写入 p3

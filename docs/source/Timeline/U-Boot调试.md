# U-Boot 调试

## 1. 更新 U-Boot 方法

可以使用多种方法更新 U-Boot

1. 使用 flash emulator 烧写器更新
2. 使用 RS-232 串口更新
3. 使用 tftp 协议从网络更新

## 2. 网络通信

处理器上有 gmac 控制器，通过总线连接到 PHY 芯片上，之后经过变压器芯片，最后通过 RJ45 网络接口实现对外网络通信。

MAC 控制器有2个，uboot的协议栈只支持一路通信，不支持两路同时通信

通过修改 PHY 芯片驱动，d2000.c 初始化流程增加写寄存器操作实现了两路网络都可通信，使用的是同一个 IP

Linux 内核中涉及到 BSP 硬件特定的芯片驱动，主线内核缺少 BSP 驱动无法识别 gmac 控制器和 PHY 芯片，无法使用有线网络功能。

主线内核需要打上 BSP 补丁，重新编译内核才能使用网络协议栈。

网络驱动是可选的，不一定与内核核心子系统链接到同一个 vlinuz 文件，如果是模块的话，编译产物在根文件系统的 `/lib/modules` 目录。

## 3. 启动校验

> 与厂商确认， D2000 属于非安全芯片，PBF 不支持启动校验

## 4. 环境变量统一化

> 注意环境变量的存储空间，不能超过存储空间

1. 将不使用的环境变量删除，只保留我们需要的环境变量

## 5. 引导操作系统

1. 从网络启动临时引导内核

2. 从 SSD 引导 openEuler 5.10 内核

操作系统内核和根文件系统是具有独立性的，内核主要负责硬件的初始化，根文件系统觉得了启动后进入的用户态程序执行环境。
不过有部分内核驱动是在根文件系统中以内核模块的形式存在的。

## 6. 启动时间优化

1. 减少不必要的日志打印，缩短启动时间
2. 减少不必要初始化流程

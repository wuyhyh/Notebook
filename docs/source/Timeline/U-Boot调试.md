# U-Boot 调试

## 1. 更新 U-Boot 方法

1. 使用 emulator 烧写器更新
2. 使用 RS-232 串口更新
3. 使用 tftp 协议从网络更新

## 2. 启动校验

从可信 U-Boot 启动 **TODO**

- 从 flash 启动 uboot 进入命令行，然后 tftp 下载 uboot_new 到内存
- 对 uboot_new 进行校验，输出编译时间和版本号、md5校验结果，
- 如果 md5 校验结果与 PC 上一致，使用 flashw 写入 uboot_new 到 flash

## 3. 环境变量统一化

> 注意环境变量的存储空间，不能超过存储空间

1. 将不使用的环境变量删除，只保留我们需要的环境变量 **TODO**

## 4. 启动时间优化

1. 减少不必要的日志打印，缩短启动时间
2. 减少不必要初始化流程：**TODO**

## 5. 两路网络通信

MAC 控制器有2个，目前只有经过交换机的一路可以与主机通信

目标是切换到另一路不走交换芯片，直接对外通信。

uboot的协议栈只支持一路通信，不支持两路同时通信，所以目标是实现切换到另一路也能正常通信

目前是使用 mii 配置寄存器的方案，这是临时方案，

需要修改 PHY 芯片驱动，初始化流程增加写寄存器操作 **TODO**

Linux 内核中也需要修改对应的 PHY 驱动，否则更换内核后网络会不稳定 **TODO**

## 6. 引导操作系统

1. 从网络启动临时引导内核

2. 从 SSD 引导 openEuler 5.10 内核 **TODO**

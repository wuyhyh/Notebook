# 技术问题时间线

记录解决的技术问题列表，和相关思路

---

## 7月-8月

### 20250708

七八月的时候的一些早期工作

#### 1. 使用 Git 进行版本管理，支持分布式协作开发

#### 2. 建立分布式文档管理仓库，支持 md 文档离线浏览器阅读

1. 摸清打包脚本PBF参数配置： DDR 训练、PCIe 工作模式配置问题的解决办法
2. 编译板级配置文件丢失，根据 `.config` 文件还原了板级配置
3. uboot 功能需要进一步定制，需要修改版级配置文件，使用 `menuconfig`修改编译组件

```text
make ARCH=arm CROSS_COMPILE=aarch64-linux-gnu- hpc_board_defconfig
```

### 20250827

1. PBF DDR training失败

解决办法是在 PBF 配置阶段关闭 one channel drive two slot

2. uboot shell 和 ramdisk Linux 找不到 nvme SSD

解决办法是在 PBF 配置阶段配置 PCIe 为 x8x8，RC mode

3. uboot 使用串口工具进行更新

下载 terarterm

## 9月

### 20250918

1. uboot 启动日志优化，缩短启动时间，但其实没有收益
2. 达成使用openEuler 5.10内核启动系统，但是沿用的是旧版 Linux 设备树和旧版根文件系统
3. 修改 ethact 环境变量，实现了uboot下两路网络通信

### 20250922

1. 下载根文件系统到 SSD
2. 解决操作系统内核对INFINIBAND的支持
3. 需要编译一个可用的ramdisk，现在的ramdisk启动概率性成功
4. 根文件系统已经启动，网络出现问题，PHY芯片驱动需要修改
5. 内核抢占模式需要修改
6. 内核ARMv8硬件加速需要关闭

### 20250923

1. 修改 uboot 网络驱动，支持 8211 芯片自动配置

### 20250924

1. PHY 芯片配置互相影响

```text
setenv ipaddr 192.168.11.102
setenv serverip 192.168.11.100
saveenv
```

```text
setenv enableNet "mii write 0x7 0x1e 0xa003; mii write 0x7 0x1f 0x8007;mii write 0x7 0x1e 0xa004; mii write 0x7 0x1f 0x00b0;mii write 0x7 0x1e 0xa001; mii write 0x7 0x1f 0x0164;mii read  0x7 0x11;"
saveenv
```

### 20250926

1. 网络问题
2. CPU0卡死
3. 新设备树编译问题

```text
./my_scripts/fix_parameter.sh
```

```text
make hpc_board_defconfig
```

### 20250928

1. 打包脚本有问题，导致SPL阶段启动失败，更换新的打包脚本包已解决问题
2. 新设备树版本的uboot网络设备无法识别
3. 串口正常，还不知道flash驱动是否正常，这涉及到qspi总线问题

### 20250929

1. 焊接了接地线，确保 flash disable，能从 emulator 启动
2. 更换设备树之后，系统无法启动

### 20250930

1. 继续适配设备树，找出不能启动的原因
2. 编译 fiptool 工具

```text
sudo apt-get install -y build-essential libssl-dev   # 若未安装依赖

git clone https://git.trustedfirmware.org/TF-A/trusted-firmware-a.git

cd trusted-firmware-a/tools/fiptool

gcc -D_GNU_SOURCE -D_XOPEN_SOURCE=700 -O2 -Wall -Werror -pedantic -std=c99 \
    -I../../include/tools_share \
    fiptool.c tbbr_config.c \
    -lcrypto -o fiptool

./fiptool --help
```

```text
ls -l u-boot.dtb
```

设备树从1347B变为了9879B

## 10月

### 20251009

现象：

1. uboot在BL2阶段启动卡住
2. 设备树从1KB增大到9KB

猜想：

1. 设备树编译后体积增大，会不会真的引起fip.bin的布局错误？导致无法启动？

思路：

1. 修改打包脚本，fip.bin的布局中不需要的部分覆盖了没事，但是系统找不到需要启动的部分

### 20251010

1. uboot 的网络问题完全解决

### 20251011

1. flash 芯片温度敏感

温度高的时候flash写入或者读取数据可能有问题，这个最好看看手册里面有没有描述。
我观察到的现象是，确定软件没有问题，如果不加风扇，温度高的情况下写入uboot到flash，写入成功后，重启大概率异常。
如果我一直开风扇，在低温的状态下写入flash，然后重启一切正常。

很可能就是flash芯片温度导致之前我们误判flash坏了，再高温的时候，使用烧录器作为emulator启动uboot，完全可以正常启动。
flash芯片对温度可能比较敏感

结论：

如果一直打开散热风扇，系统工作正常

2. 完善 U-Boot 部分的文档

### 20251021

1. 使用新设备树编译的内核，启动之后支持多核，但是网络驱动有问题
2. 构建系统是否稳定呢？使用Ubuntu24.04编译中途没有出现问题

#### 启动后的网络问题，需要手动更新 ARP 缓存。

### 20251023

1. 编译系统如何定制化内核？
2. 网络驱动如何加载
3. 如何启用网络 bonding，两路网络外部都有数据包流入时如何处理？放弃bonding，应用场景不需要
4. 制作 ramdisk 启动小型 Linux，10月27日已经形成基线版本

### 20251028

从网络加载根文件系统

- 编译机器 WSL: Ubuntu 24.04
- NFS 服务器 VMware: Fedora42，IP: 192.168.79.128
- Windows 11 用作 tftp server，以太网配置为静态IP: 192.168.11.100，有线连接。无线 WLAN 用于上外网，与开发调试无关。
- ARM64 开发板以太网有线连接，U-Boot IP: 192.168.11.101

TODO:
感觉内核没有编译NFS客户端，太麻烦了，我还是使用写入 ssd 的方法测试吧。

## 11月

### 20251103-1107

1. 编译 initramfs，测试启动参数和网络功能、块设备管理，实现分区创建和文件系统创建。
2. 配置 wsl ssh server，开发板通过 initramfs 系统中的 ssh 登录和验证 scp 命令，实现 2G 文件一分钟内传送。

### 20251114

openeuler 操作系统启动基线版本移植到开发板上

### 20251117

1. 如何编译 hello.ko 并移植到开发板上

/dev/nvme0n1p2: UUID="700d9e8b-e707-45da-bf85-836b0a51c045" TYPE="ext4"

```text
setenv bootnvme_p2 'pci init; nvme scan; \
ext4load nvme 0:2 ${kernel_addr_r} /boot/Image-5.10.0-phytium-embedded-v2.3; \
ext4load nvme 0:2 ${fdt_addr_r}   /boot/pd2008-devboard-dsk.dtb; \
setenv bootargs "${console} root=/dev/nvme0n1p2 rw rootwait earlycon ignore_loglevel loglevel=8 audit=0" \
booti ${kernel_addr_r} - ${fdt_addr_r}'

saveenv
```

## 12 月

### 20251216

现场演示的测试用例。

### 20251222

1. 整理高性能计算项目的背景信息
2. 分析下一阶段需求

先看看接口名和当前状态：

```text
ip link
ip a
```

1. 给 eth0/eth1 配 IP

## 清掉原来的地址（可选）

```text
ip addr flush dev eth0
ip addr flush dev eth1
```

## 配地址

```text
ip addr add 192.168.11.105/24 dev eth0
ip addr add 192.168.11.106/24 dev eth1
```

## 拉起来

```text
ip link set eth0 up
ip link set eth1 up
```

gitlab的 root 管理员 密码是 wuyh12#$

```text
ip address add 192.168.11.105/24 dev eth0
ip address add 192.168.11.105/24 dev eth0
```

在开发板上使用本地 yum 源安装程序：

```text
dnf --disablerepo='*' --enablerepo='openEuler-local' install vim
```

```text
date -s "2025-12-31 12:00:00"
```

1. 总体架构的讲解，背景，框图，数据流，技术选择的理由。长远的路径规划，问题的全生命周期。
2. 后续操作系统功能的扩展和测试，多核和调度优化，功耗和性能
3. 用户的视角。
4. 规范化交付：软硬件，打上log

## 报告修改：

架构图
操作系统选型理由

## 验收意见




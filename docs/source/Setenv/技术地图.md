# 技术地图

## 目标与使用方式

* **目标**：将分散知识沉淀为可复用的工程化资产：体系化笔记、复盘库、脚手架与清单，既服务个人深耕，也能直接用于新同学培养。
* **产出形态**：每一章均包含「概念速览」「操作手册」「实验与作业」「常见坑位」「复盘案例」「参考链接/进一步阅读」。
* **组织方法**：采用 *MOC（Map of Content）+ 模块章* 结构；每个主题都配套可跑通的最小可行实验（MVE）。
* **约定**：

    * 代码/命令遵循 Linux 内核风格；示例覆盖 Fedora/Ubuntu/openEuler。
    * 文档头部使用统一元数据（YAML front matter），便于检索与汇总。

---

## 总体目录（MOC）

1. 基础与方法论
2. 工具链与环境
3. 硬件与体系结构基础
4. 启动链路与 Boot 软件栈（UEFI/TF‑A/U‑Boot/内核/initramfs/GRUB）
5. Linux 内核开发（构建/调试/子系统）
6. 驱动与设备模型（Device Model/DT/PCIe/USB/QSPI/NVMe）
7. 存储与文件系统（Flash/UBI/UBIFS/NVMe/块层）
8. 内存管理与分级内存（TMO/MAT 卡/迁移算法/hugepage）
9. 网络与 RDMA（SoftRoCE/DPU/内核网络栈）
10. 性能分析与优化（perf/ftrace/eBPF/基准）
11. 虚拟化与仿真（QEMU/KVM/virtio/FireMarshal）
12. 固件与嵌入式工程（BSP/板级移植/OTA/flashrom）
13. 工程实践（CI/CD/打包/RPM/发布/安全）
14. 文档工程与知识管理（MkDocs/翻译/术语表/图谱）
15. 复盘库（故障、性能、移植）
16. 实习生培养手册（0‑30‑60‑90 天）
17. 模板与脚手架（Issue/PR/实验/设计文档/驱动骨架）
18. 附录（速查表、清单、书单）

---

## 目录结构建议（适配 MkDocs）

```
notebook/
├─ docs/
│  ├─ index.md
│  ├─ moc.md                     # 内容地图（本页精简版）
│  ├─ foundations/               # 基础与方法论
│  ├─ toolchain-env/             # 工具链与环境
│  ├─ arch-hw/                   # 硬件与体系结构
│  ├─ boot/                      # UEFI/TF-A/U-Boot/GRUB/Linux 启动
│  ├─ kernel/                    # 内核开发总览
│  │  ├─ build-debug/            # 构建/调试/符号/崩溃
│  │  ├─ mm/                     # 内存管理专题
│  │  ├─ fs/                     # VFS/FS
│  │  ├─ net/                    # 网络栈
│  │  └─ block/                  # 块层
│  ├─ drivers/                   # 设备驱动模型与子系统
│  ├─ storage/                   # 存储与文件系统
│  ├─ mem-tiering/               # 分级内存与研究
│  ├─ rdma/                      # RDMA/SoftRoCE/DPU
│  ├─ perf/                      # 性能分析与调优
│  ├─ virt/                      # 虚拟化与仿真
│  ├─ embedded/                  # 固件/嵌入式/OTA
│  ├─ eng-practices/             # 工程化实践
│  ├─ docops/                    # 文档工程与知识管理
│  ├─ postmortems/               # 复盘库
│  ├─ intern-handbook/           # 实习生培养
│  ├─ templates/                 # 模板与脚手架
│  └─ appendix/                  # 速查表/术语/书单
├─ scripts/
├─ assets/
└─ mkdocs.yml
```

**mkdocs.yml 片段**

```yaml
site_name: LSE Notebook
theme:
  name: material
  features:
    - navigation.sections
    - navigation.indexes
    - content.code.copy
markdown_extensions:
  - admonition
  - toc:
      permalink: true
  - pymdownx.highlight
  - pymdownx.superfences
  - pymdownx.details
  - tables
  - footnotes
plugins:
  - search
  - tags
nav:
  - 首页: index.md
  - 内容地图: moc.md
  - 基础: foundations/index.md
  - 工具链: toolchain-env/index.md
  - 启动链路: boot/index.md
  - 内核: kernel/index.md
  - 驱动: drivers/index.md
  - 存储: storage/index.md
  - 内存分级: mem-tiering/index.md
  - 网络/RDMA: rdma/index.md
  - 性能: perf/index.md
  - 虚拟化: virt/index.md
  - 嵌入式: embedded/index.md
  - 工程实践: eng-practices/index.md
  - 文档工程: docops/index.md
  - 复盘库: postmortems/index.md
  - 实习生手册: intern-handbook/index.md
  - 模板: templates/index.md
  - 附录: appendix/index.md
```

**页面元数据（统一 Front Matter）**

```yaml
---
title: <页面标题>
tags: [kernel, mm, rdma]
authors: [wuyuhang]
status: draft  # draft | review | done
updated: 2025-09-02
summary: <一句话本页要解决的核心问题>
---
```

---

## 1. 基础与方法论（foundations/）

* **知识框架**：计算机系统（ISA→微架构→内存层次→OS→编译与链接→运行时）、软件工程方法（可测性/可观察性/可复现）、实验设计（变量控制与对照）、问题分解与复盘（5 Whys、鱼骨图）。
* **最小实验**：

    * 「从 C 到 ELF」：手写 `start.s` + `main.c`，观察 `objdump -d` 与 `readelf -a`。
    * 「Cache 效应」：遍历方式影响带宽与延迟的对比小实验。
* **清单**：

    * 你是否能用 5 张图画出：启动链路、内存层次、进程/线程/调度、I/O 路径、网络路径？

---

## 2. 工具链与环境（toolchain-env/）

* **构建**：GCC/Clang、cross‑gcc、CMake/Make、RPM/Deb（以 *RPM 内核打包流水线* 为例）。
* **调试与可观测**：gdb, kgdb, crash, pahole, perf/ftrace/BPF 工具箱。
* **虚拟化与实验台**：QEMU/KVM、VMware、容器；可复现实验镜像与脚本。
* **版本与协作**：Git 工作流、提交规范（kernel-style）、代码评审清单。
* **最小实验**：内核 RPM 一键构建脚本与可复现实验镜像（含 `scripts/`）。

---

## 3. 硬件与体系结构（arch-hw/）

* ARMv8/AMBA 总线、缓存一致性、TLB、MMU、页表、NUMA。
* I/O：PCIe（lane/链路训练/ BAR / MSI/MSI‑X）、QSPI、I2C、SPI、UART。
* DDR/PHY/训练要点（与实际 bring‑up 日志对应解读）。
* **最小实验**：`/proc/cpuinfo`、`lscpu`、`lspci -vv`, `setpci` 修改寄存器的受控实验。

---

## 4. 启动链路（boot/）

* **路径**：ROM → BL1/TF‑A → BL2 → U‑Boot（SPL）→ 内核 + DTB + initramfs → systemd → 用户态。
* UEFI 基础、FIP/FIT 打包流程、镜像布局、签名与校验、常见坑（电源/时钟/DDR）。
* **实验**：

    * 用 QEMU 复现：UEFI → Linux；
    * U‑Boot 环境下 `loady`/`tftpboot` → `mmc/nor write`；
    * FIP 打包脚本走读与改造（可观测日志）。

---

## 5. Linux 内核开发（kernel/）

* **构建/安装/切换内核**：vanilla vs distro 补丁；BLS 引导；多内核共存。
* **调试**：`dmesg`/`trace_printk`/`dynamic_debug`/`ftrace`/`perf`；Oops/Panic 分析；`crash` 走查。
* **子系统**：MM、VFS、Block、Net、Scheduler、Cgroup、Security(LSM/SELinux)。
* **实验**：为每个子系统设计「一个开关」→ 验证可观测与影响面。

---

## 6. 设备驱动与设备模型（drivers/）

* **模型**：kobject → device/driver/bus/class；Device Tree/ACPI；probe/remove/pm。
* **总线专题**：PCIe、SPI/QSPI、I2C、MDIO、USB、NVMe。
* **测试**：`configfs`/`sysfs`/`debugfs` 验证；Udev 规则；fault injection。
* **实验**：从 0 到 1 写一个字符设备与一个 SPI NOR 驱动骨架，覆盖 probe/IOCTL/pm。

---

## 7. 存储与文件系统（storage/）

* **介质**：Flash（S/LC/MLC/TLC）、MRAM、NVMe；磨损/对齐/坏块管理。
* **栈**：MTD/UBI/UBIFS；块层/IO 调度器；ext4/xfs/f2fs；flashrom 基础。
* **实验**：fio/`nvme-cli`；UBI/UBIFS 的创建与挂载流程演练。

---

## 8. 内存管理与分级内存（mem-tiering/）

* **核心主题**：伙伴系统、slab、vma/rmap、NUMA、THP、交换；TMO/SMAP 思路。
* **研究线**：基于 MAT 卡的 PFN 访问频度 → 页冷热分层 → 迁移策略（周期、阈值、批量）。
* **实验**：

    * 2MiB hugepage 对 Redis/OLTP 的影响测量；
    * `migrate_pages`/`mbind`/`numactl` 控制实验；
    * 设计并验证「直方图‑驱动」冷热判定（离线/在线）。
* **产出**：算法白皮书 + 评测脚本 + 可复现实验镜像。

---

## 9. 网络与 RDMA（rdma/）

* **内核网络栈**：从 syscalls→socket→skb→qdisc→NIC DMA；Offload 要点。
* **RDMA**：verbs、SoftRoCE、RoCEv2、DPU 拓扑；零拷贝路径；调优参数。
* **实验**：两机/两虚机 SoftRoCE；`ibv_rc_pingpong` 到自写微基准。

---

## 10. 性能分析与优化（perf/）

* **工具簇**：perf/ftrace/trace‑cmd/bcc/bpftrace/FlameGraph/`pmu-tools`。
* **方法**：指标树（延迟/吞吐/CPU/内存/IO/网络）；瓶颈定位流程；回归守护。
* **实验**：端到端基准（STREAM、lmbench、fio、netperf）脚本化与报表生成。

---

## 11. 虚拟化与仿真（virt/）

* **QEMU/KVM**：virtio 家族、内外核态接口；FireMarshal 批量实验。
* **用例**：为内存分级/驱动/网络设计可复现实验台，固化在 `scripts/`。

---

## 12. 固件与嵌入式工程（embedded/）

* **BSP/板级支持**：引脚/时钟/电源/存储映射；设备树裁剪与校验。
* **镜像与 OTA**：FIP/FIT、A/B 分区、回滚策略、安全启动概念。
* **实验**：串口 `loady`/`loads`/`tftpboot`、`sf`/`mmc` 写入流程；掉电/异常恢复演练。

---

## 13. 工程实践（eng-practices/）

* **CI/CD**：预提交检查（clang‑format, checkpatch.pl, static‑analysis）、单测/集成测试、发布流水线。
* **打包与发布**：内核/驱动 RPM；Changelog 与发布说明模板。
* **安全与合规**：SBOM、CVE 跟踪、签名与镜像信任链。

---

## 14. 文档工程与知识管理（docops/）

* **写作规范**：层次化标题、含义先行、示意图优先；术语中英对照表。
* **工具链**：MkDocs Material、Mermaid、PlantUML；翻译流水线与术语表维护。
* **知识图谱**：建设跨页索引（术语→案例→脚手架）。

---

## 15. 复盘库（postmortems/）

* **分类**：启动失败/性能退化/驱动异常/网络不通/存储损坏。
* **模板**：时间线、影响范围、根因、证据链、修复与验证、预防措施、后续任务。

---

## 16. 实习生培养手册（intern-handbook/）

* **0‑30 天**：环境搭建、阅读路线、两项 MVE（如字符设备 + QEMU 启动链路复现）。
* **30‑60 天**：跟做一个真实子系统小改动，提交可合入的 PR。
* **60‑90 天**：独立完成一个专题实验（性能或驱动），交付报告与脚本。
* **配套**：每日站会卡片、周报模板、代码评审清单、学习打卡脚本。

---

## 17. 模板与脚手架（templates/）

### 17.1 实验记录模板 `templates/experiment.md`

```markdown
---
title: <实验主题>
owner: <负责人>
status: running
---
## 目标
## 背景
## 环境
- OS/内核：
- 硬件：
- 工具：
## 步骤
1.
2.
## 结果与数据
## 分析与结论
## 产出
- 脚本：
- 图表：
## 后续
```

### 17.2 设计文档模板 `templates/design.md`

```markdown
# 背景与目标
# 需求与约束
# 方案选型与权衡
# 架构与时序
# 兼容性/可观察性/可测试性/可运维性
# 风险与备选
# 里程碑与验收标准
```

### 17.3 复盘模板 `templates/postmortem.md`

```markdown
# 事件概述
- 发生时间：
- 影响范围：
# 时间线
# 诊断与根因
# 修复与验证
# 预防措施
# TODO
```

### 17.4 Issue/PR 模板（片段）

```markdown
## 变更说明
## 测试覆盖
## 风险与回滚
## 关联问题/文档
```

### 17.5 驱动骨架（目录与要点）

```
driver-skeleton/
├─ include/
├─ src/
│  ├─ probe.c       # 模块加载/匹配/资源获取
│  ├─ ioctl.c       # 用户态接口（如需）
│  ├─ pm.c          # suspend/resume
│  └─ debugfs.c     # 可观测开关
├─ tests/
└─ Makefile         # Kbuild/Out-of-tree
```

---

## 18. 附录（appendix/）

* **速查表**：`git`、`perf/ftrace`、`ebpf`、`crash`、`qemu`、`nvme-cli`、`flashrom` 命令卡片。
* **学习清单**：从「能跑通」→「能解释」→「能优化」三级；每章配 3–5 个核对点。
* **术语表**：中英对照 + 简短释义；统一规范。

---

## 选读路径建议（可作为首页引导）

* **新人/实习生**：工具链 → 启动链路 → 字符设备驱动 → 基准工具 → 一次完整复盘。
* **专注内存**：基础 → kernel/mm → mem-tiering → perf → virt（用于构造对照实验）。
* **专注网络/RDMA**：网络栈 → rdma → perf（网络指标）→ 复盘案例。

---

## 交付要求（每章统一）

* 一页「概念速查图」+ 一份「最小可运行实验」+ 一份「常见坑与诊断清单」+ 三条「可复用脚本」。
* 数据有脚本、图有原始数据、结论可复现。
